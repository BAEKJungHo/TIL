<mxfile host="app.diagrams.net" modified="2022-04-10T07:20:17.709Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.75 Safari/537.36" etag="nx_jiqqmj_21dfbLAg7G" version="17.4.1" type="github">
  <diagram id="IrGgiRlmW6_dUhyTT4IY" name="Page-1">
    <mxGraphModel dx="1422" dy="1923" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-3" value="authentication-service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="226" y="-934" width="129" height="60" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-5" value="authorization-service" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=default;" parent="1" vertex="1">
          <mxGeometry x="654" y="-934" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-6" value="Client - 관리자&lt;br&gt;(호텔,&amp;nbsp; 브랜드,&amp;nbsp; etc...)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="27" y="-934" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-10" value="&lt;h1&gt;B2B 인증/인가&lt;/h1&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="19" y="-1146" width="403" height="43" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-11" value="Resource (b2b - service)&lt;br&gt;(호텔, 객실, etc...)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="383" y="-934" width="172" height="60" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-13" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" target="iuF1NLF-qFcUfZnnZ7mx-6" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="87" y="-379" as="sourcePoint" />
            <mxPoint x="77" y="-787" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-16" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;" parent="1" target="iuF1NLF-qFcUfZnnZ7mx-3" edge="1" source="XttH_GJxqyAqiv7cMvlf-16">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="291" y="-383" as="sourcePoint" />
            <mxPoint x="290" y="-865" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-17" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" target="iuF1NLF-qFcUfZnnZ7mx-11" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="469" y="-386" as="sourcePoint" />
            <mxPoint x="383" y="-653" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-18" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;" parent="1" target="iuF1NLF-qFcUfZnnZ7mx-5" edge="1" source="XttH_GJxqyAqiv7cMvlf-25">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="714" y="-388" as="sourcePoint" />
            <mxPoint x="433" y="-653" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-19" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="89.5" y="-836" as="sourcePoint" />
            <mxPoint x="292.5" y="-836" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-20" value="Login Request (OAuth2, etc ...)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="104" y="-863" width="178" height="21" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-22" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="285" y="-831" width="11" height="64" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-29" value="Access Token / Refresh Token" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="107.5" y="-801" width="171" height="21" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-32" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="88" y="-735" as="sourcePoint" />
            <mxPoint x="467.5" y="-735" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-33" value="If Not Expried AccessToken - Resource Request with Access Token" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="97.5" y="-758" width="365" height="18" as="geometry" />
        </mxCell>
        <mxCell id="iuF1NLF-qFcUfZnnZ7mx-34" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="462.5" y="-732" width="11" height="223" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-6" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="283" y="-775" as="sourcePoint" />
            <mxPoint x="88" y="-775" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-8" value="- Front 에서 AccessToken 의 유효기간을 판단하여 만료되거나, 만료되기 직전에 authentication-service 로 재발급 요청 하는 로직이 있다고 가정&lt;br&gt;- Refresh Token 과 사용자에 대한 관련 정보 및 권한들을 Redis(In-memory storage)에 보관&lt;br&gt;&amp;nbsp; &amp;nbsp; - Refresh Token 저장용 Redis 와 사용자/권한 관련 정보를 저장하기 위한 Redis 가 별도로 존재&lt;br&gt;- authentication-service Redis 에서는 refresh token 을 저장&lt;br&gt;- authorization-service Redis 에서는&amp;nbsp; User Inforamtion 을 저장 (userId 와 권한정보들을 저장)&lt;br&gt;- authorization-service 에서 token 을 검증하고 payload 에서 userId 를 추출한 다음, 해당 ID 값으로 권한을 조회&lt;br&gt;- 권한이나 유저 정보가 변경될 때마다 redis replica 에 들어있는 정보들을 update 쳐준다고 가정&lt;br&gt;- 로그아웃을 하거나, 첫 로그인 후 3분이 지나면 Refresh Token 사용 불가 (memory 에서 제거 됨)&lt;br&gt;- Access Toeken 이 만료되면 Refresh Token 의 유효성과 Redis 의 Refresh Token 존재 유무를 확인한 후 재발급 진행" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="25" y="-1103" width="782.5" height="149" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-9" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="462.5" y="-589" as="sourcePoint" />
            <mxPoint x="89.5" y="-589" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-10" value="return" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="362.5" y="-616" width="55" height="21" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-11" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="83" y="-525" width="11" height="83" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-12" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="94.5" y="-515" as="sourcePoint" />
            <mxPoint x="297.5" y="-515" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-13" value="If Expried AccessToken&amp;nbsp;&lt;br&gt;Access Token + Refresh Token" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="106" y="-542" width="193.5" height="18" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-16" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="286.5" y="-509" width="11" height="81" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-17" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" target="XttH_GJxqyAqiv7cMvlf-16">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="291" y="-383" as="sourcePoint" />
            <mxPoint x="290.5" y="-874" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-18" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="284.5" y="-453" as="sourcePoint" />
            <mxPoint x="92.5" y="-453" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-20" value="Access Token / Refresh Token" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="106" y="-479" width="171" height="21" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-21" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="473.5" y="-716" as="sourcePoint" />
            <mxPoint x="716" y="-716" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-22" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.078;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="iuF1NLF-qFcUfZnnZ7mx-22">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="301" y="-826" as="sourcePoint" />
            <mxPoint x="296" y="-786" as="targetPoint" />
            <Array as="points">
              <mxPoint x="337" y="-826" />
              <mxPoint x="337" y="-786" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-23" value="RefreshToken&amp;nbsp; Saved In Redis" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="282" y="-817" width="201" height="21" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-25" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="708.5" y="-711" width="11" height="223" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-26" value="" style="endArrow=none;dashed=1;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" target="XttH_GJxqyAqiv7cMvlf-25">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="714" y="-388" as="sourcePoint" />
            <mxPoint x="714" y="-874" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-27" value="Search User using Token" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="502" y="-738" width="192.5" height="18" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-28" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="705" y="-628" as="sourcePoint" />
            <mxPoint x="476" y="-628" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-29" value="return User Information with Grant" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="501" y="-650" width="192.5" height="18" as="geometry" />
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-30" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.078;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="719" y="-691.998" as="sourcePoint" />
            <mxPoint x="719" y="-651.99" as="targetPoint" />
            <Array as="points">
              <mxPoint x="760" y="-691.99" />
              <mxPoint x="760" y="-651.99" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XttH_GJxqyAqiv7cMvlf-31" value="Find In Redis" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="657" y="-683" width="201" height="21" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
