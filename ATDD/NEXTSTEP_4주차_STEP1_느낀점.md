# NEXTSTEP_4주차_STEP1_느낀점

- [Source and Code Review](https://github.com/next-step/atdd-subway-fare/pull/116)

## STEP1 - 경로 조회 타입 추가

### 요구사항

- 경로 조회 시 최소 시간 기준으로 조회할 수 있도록 기능을 추가하세요.
- 노선추가 & 구간 추가 시 거리와 함께 소요시간 정보도 추가하세요.
- 인수 테스트 (수정) -> 문서화 -> 기능 구현 순으로 진행하세요.
- 개발 흐름을 파악할 수 있도록 커밋을 작은 단위로 나누어 구현해보세요.

## 인수 조건

```
Feature: 지하철 경로 검색

  Scenario: 두 역의 최소 시간 경로를 조회
    Given 지하철역이 등록되어있음
    And 지하철 노선이 등록되어있음
    And 지하철 노선에 지하철역이 등록되어있음
    When 출발역에서 도착역까지의 최소 시간 기준으로 경로 조회를 요청
    Then 최소 시간 기준 경로를 응답
    And 총 거리와 소요 시간을 함께 응답함
```

## 느낀점

- 문서화가 처음이라 TDD 사이클을 지키는게 어려웠다.
- 깨지기 쉬운 테스트 코드가 어떤 것인지 배웠다.

## 피드백

> duration 이 추가됨에 따라 많은 Production Code 와 Test Code 를 변경하게 되었는데,이런것이 깨지기 테스트 코드인지 궁금합니다.

깨지기 테스트 코드라는 단어는 저도 잘 모르겠네요 😢
다만, 테스트가 깨지기 쉽다는 것은 대체로 내부 구현을 검증하는 테스트라는 것입니다.
그렇기에 내부 구현의 변경에 따라 테스트크가 많이 깨질 수 있는 것인데, 이럴수록 테스트 코드가 리팩토링 내성이 떨어지면서 로직을 조금만 수정해도 테스트코드가 모두 깨져버리게 되는 문제가 생기죠.
그래서 최종 결과 검증을 작성하고 내부 구현에 대한 검증을 포기해야겠죠. 이건 각각의 장단점이 있기에 트레이드오프의 문제입니다. 테스트 중 화이트박스 테스트는 기본 전제가 내부의 로직을 개발자가 다 파악하고 있다고 생각하고 내부 구현을 분기, 예외, 성공등을 모두 검증하는 테스트를 작성하지만, 위와같이 깨지기 쉽게 되겠죠. 블랙박스 테스트는 내부 구현을 노출하지 않았기에 최종 결과만 검증하기에 잘 깨지지 않게 되는 것이구요. (블랙박스에서 약간의 기능변경으로 깨진다면 해당 메서드가 다른 메서드에 영향을 많이 받거나 문제가 있다는 것이구요. )

이부분을 자각하고, 트레이드 오프를 계산해서 작성하시면 됩니다.
저 같은 경우 정말 왠만해서는 깨지기 쉬운 테스트라도 화이트박스도 하는 편입니다 ㅎ

> Legacy 를 리팩토링할 때에는 기존 코드를 건드리지 않고 진행하지만, .... 실제 코드를 바로 변경시켜도 되는건지 궁금합니다.

테스트 코드의 목적 자체가 메서드에 대한 신뢰성을 보증하기 위해 작성하는 것입니다. 기능의 추가/변경이 일어나면 테스트 기반으로 코드를 수정하는게 맞겠죠.
근데, 실무에서는 여러 방안들이 있겠지만 바로 프로덕션 코드를 수정하는게 아닌 브랜치를 따거나, 혹은 우리가 설계를 보통 인터페이스 기반으로 추상화 설계를 하기에 추상화 객체를 구현하는 V2 구현체를 만들어 이에 대한 테스트 주도 개발을 진행 후 이를 협업관계간에 리뷰 이후 반영하는 편이죠. 바로 프로덕션 코드와 테스트 코드를 건드리면서 개발하는것은 코드의 안전성 문제를 떠나 하위호환성 문제로 지양해야겠죠 ㅎ

저는, 프로젝트가 커지고 기능과 의존성이 복잡하게 얽힐수록 브랜치, 혹은 다음 버전의 구현체를 만들어서 테스트까지 마친 후 프로덕션에 제공하도록 하는 편입니다. 😄
