## 자바 엑셀 파일 읽기

- 메이븐 추가

```xml
    <!-- apache poi -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi</artifactId>
        <version>4.0.1</version>
    </dependency>

    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
        <version>4.0.1</version>
    </dependency>
```

- 자바

```java
@RestController
@RequiredArgsConstructor
@RequestMapping("/migration/facilityApply/api")
public class MigrationFacilityApplyController {

    private static final String filePath = "C:\\fileName.xlx";
    private final MecFacilityApplyRepository facilityApplyRepository;
    private final MecFacilityApplyService facilityApplyService;
    private final MecPrivacyInfoService privacyInfoService;

    @GetMapping
    public ResponseEntity migrationFacilityApply() {
        try(InputStream inputStream = new FileInputStream(filePath)) {
            // 엑셀 로드
            Workbook workbook = WorkbookFactory.create(inputStream);
            // 첫 번째 시트 로드
            Sheet sheet = workbook.getSheetAt(0);
            Iterator<Row> rowItr = sheet.iterator();
            while(rowItr.hasNext()) {
                MecFacilityApplyVo facilityApplyVo = new MecFacilityApplyVo();
                Row row = rowItr.next();
                // 첫 번째 행이 헤더인 경우 스킵, 2번째 행부터 data 로드
                if(row.getRowNum() == 0) {
                    continue;
                }

                Iterator<Cell> cellItr = row.cellIterator();
                // 셀 읽기
                while(cellItr.hasNext()) {
                    Cell cell = cellItr.next();
                    int index = cell.getColumnIndex();
                    switch (index) {
                        case 0 : // 첫 번째 열 (primary key)
                            facilityApplyVo.setFacilityApplySeq(((Double) getValueFromCell(cell)).intValue());
                            break;
                        case 1 : // 두 번째 열 (foreign key)
                            String fkType = (String) getValueFromCell(cell);
                            facilityApplyVo.setFacilitySeq(getFacilitySeq(fkType));
                            break;
                        case 2 : // 세 번째 열 (신청자 portal id)
                            /**
                             * portal id 로,  이름(NM_KOR), 학과명(NM_NIC), 전화번호(HOME_TEL, OFFC_TEL)
                             * 핸드폰(MOBILE_TEL), 이메일(EMAIL_ADDR)
                             * 조회해서 개인정보 테이블에 세팅
                             * OFFC_TEL 이 널이거나 빈값이면 HOME_TEL 로 설정
                             */
                            facilityApplyVo.setRegId((String) getValueFromCell(cell));
                            createPrivacyInfoAndSetFacilityApply(facilityApplyVo);
                            break;
                        case 3 : // 네 번째 열 (행사명)
                            facilityApplyVo.setTitle((String) getValueFromCell(cell));
                            break;
                        case 4: // 다섯 번째 열 (applyDate)
                            facilityApplyVo.setApplyDate((String) getValueFromCell(cell));
                            break;
                        case 5: // 여섯 번째 열 (startTime)
                            facilityApplyVo.setStartTime(((Double) getValueFromCell(cell)).intValue());
                            break;
                        case 6: // 일곱 번째 열 (endTime)
                            facilityApplyVo.setEndTime(((Double) getValueFromCell(cell)).intValue());
                            break;
                        case 7: // 여덟 번째 열 (peoplecount)
                            facilityApplyVo.setPeopleCount((String) getValueFromCell(cell));
                            break;
                        case 8: // 아홉 번째 열 (purpose)
                            facilityApplyVo.setPurpose((String) getValueFromCell(cell));
                            break;
                        case 9: // 열 번째 열 (item)
                            facilityApplyVo.setItem((String) getValueFromCell(cell));
                            break;
                        case 10 : // 열 한 번째 열 (teacher)
                            facilityApplyVo.setTeacher((String) getValueFromCell(cell));
                            break;
                        case 11 : // 열 두 번째 열 (regDate)
                            if(getValueFromCell(cell) != null && StringUtils.isNotBlank((String) getValueFromCell(cell))) {
                                facilityApplyVo.setRegDate(((String) getValueFromCell(cell)).substring(0,19));
                            } else {
                                facilityApplyVo.setRegDate("2020-03-20 00:00:00");
                            }
                            break;
                        case 12 : // 열 세 번째 열 (state)
                            String stateName = (String) getValueFromCell(cell);
                            if(StringUtils.equals("허가", stateName)) {
                                facilityApplyVo.setState("E");
                            } else if(StringUtils.equals("불가", stateName)) {
                                facilityApplyVo.setState("D");
                            } else if(StringUtils.equals("결재중", stateName)) {
                                facilityApplyVo.setState("A");
                            }
                            break;
                        case 13 : // 열 네 번째 열 (content)
                            String content = (String) getValueFromCell(cell);
                            if(content != null && !"N".equals(content) && StringUtils.isNotBlank(content)) {
                                facilityApplyVo.setContent(content);
                            }
                            break;
                    }
                }

                // 한 셀을 다 읽고 createFacilityApplyVo
                facilityApplyService.createFacilityApply(facilityApplyVo);
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }

        return ResponseEntity.ok("success");
    }


    private static Object getValueFromCell(Cell cell) {
        switch(cell.getCellType()) {
            case STRING:
                return cell.getStringCellValue();
            case BOOLEAN:
                return cell.getBooleanCellValue();
            case NUMERIC:
                if(DateUtil.isCellDateFormatted(cell)) {
                    return cell.getDateCellValue();
                }
                return cell.getNumericCellValue();
            case FORMULA: return cell.getCellFormula();
            case BLANK: return "";
            default: return "";
        }
    }

https://suyou.tistory.com/158
